<div class="module-header">
  <div class="module-title">
    Pr√©stamos
  </div>
  <div class="module-actions">
  </div>
</div>
<div class="module-workarea">
  <div class="item-area">
  	<div class="item-workarea">
  	  <div class="row">
        <div class="col s4 item-main">
          <table>
          	<tr><th colspan="3">Disponibles</th></tr>
            <% @loanables.each do |i| %>
              <tr><td><%= i.name %></td><td><%= i.item_type.name %></td><td><a href="#" class="waves-effect waves-light btn-small blue-grey btn modal-trigger" data-target="modal-loan" data-item-id="<%= i.id %>" id="prestar-<%= i.id %>">Prestar</a>
              </td></tr>
            <% end %>
          </table>  
        </div>
        <div class="col s8 item-main">
          <table>
          	<tr><th colspan="4">Prestados</th></tr>
            <% @loaned.each do |loan| %>
              <tr><td><%= loan.item.name %></td><td><%= loan.item.item_type.name %>
                <% if loan.notes != '' %>
                  <div class="loan-notes"><%= loan.notes %></div>
                <% end %>
              </td><td>Del <%= loan.created_at.strftime('%Y-%m-%d') %> al <%= loan.return_date.strftime('%Y-%m-%d') %></td><td><a href="#modal-return" class="waves-effect waves-light btn-small blue-grey modal-trigger">Regresar</a></td></tr>
            <% end %>
          </table>  
        </div>
      </div>
  	</div>
  </div>
</div>

<!-- Modal Structure -->
  <div id="modal-loan" class="modal">
    <% @loan = Loan.new %>
    <%= form_with(model: @loan, local: true) do |form| %>
      <%= form.hidden_field :item_id %>
    <div class="modal-content">
      <div class="row">
        <div class="input-field col s12">
          <%= form.collection_select :people_id, Person.order('first_name', 'last_name'), :id, :full_name  %>
          <%= form.label :people_id, "Solicitante" %>
        </div>
      </div>

      <div class="row">
        <div class="input-field col s12">
          <%= form.text_area :notes, id: :ticket_notes, 'class': "materialize-textarea" %>
          <%= form.label :notes, 'Notas' %>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <%= form.submit 'Prestar', class: 'waves-effect waves-light btn-small blue-grey' %>
    </div>
    <% end %>
  </div>

<script>
  $(document).ready(function(){
    $('#modal-loan').modal({
      onOpenStart: function(modal, trigger) { 
        $("#loan_item_id").val($("#" + trigger.id).data("item-id"));
      }
    });
  });
</script>